import{_ as y,r as m,h as C,k as u,c as h,a as o,t as L,w as B,u as $,o as _,S as w,l as x,j as A,e as r,m as I,v as P,f as v,d as T,g as k,p as D,q as S}from"./index-D9LBVFIm.js";import{a as c}from"./index-NIGUFBhG.js";const M="/todolist/todo_banner.png",O={class:"nav"},E={class:"todo_sm"},R={__name:"TheNav",setup(b){const f=$(),i=m(""),a=()=>{w.fire({icon:"warning",title:"登出",text:"確定要登出嗎？",confirmButtonText:"確定",showCancelButton:!0,cancelButtonText:"取消"}).then(n=>{n.isConfirmed&&(x("token"),x("nickname"),w.fire({icon:"success",title:"即將登出",text:"將傳送至登入頁",timer:2e3,timerProgressBar:!0,showConfirmButton:!1}).then(()=>{f.push("/")}))})};return C(async()=>{const n=u("nickname");i.value=n||""}),(n,p)=>(_(),h("nav",O,[p[0]||(p[0]=o("h1",null,"ONLINE TODO LIST",-1)),o("ul",null,[o("li",E,[o("span",null,L(i.value?i.value+" 的代辦":"您的代辦"),1)]),o("li",null,[o("a",{href:"#",onClick:B(a,["prevent"])},"登出")])])]))}},j=y(R,[["__scopeId","data-v-0ef95629"]]),q={class:"wrap bg-half"},U={id:"todoListPage",class:"todoListPage"},F={class:"todoList_Content"},G={class:"inputBox"},H={key:0,class:"todoList_list"},J={class:"todoList_tab"},K={class:"todoList_items"},Q={class:"todoList_item"},W={class:"todoList_statistics"},X={key:1,class:"noItem"},d="https://todolist-api.hexschool.io/",Y={__name:"TodoListPageView",setup(b){const f=$(),i=m({nickname:"",uid:""}),a=m([]),n=m(""),p=async()=>{const s=u("token");if(n.value.trim())try{const t=await c.post(`${d}todos`,{content:n.value},{headers:{Authorization:s}});a.value.push({id:t.data.newTodo.id,text:t.data.newTodo.content,completed:t.data.newTodo.status}),n.value=""}catch(t){console.error("新增待辦失敗",t)}},N=async s=>{const t=u("token");try{await c.delete(`${d}todos/${s}`,{headers:{Authorization:t}}),a.value=a.value.filter(e=>e.id!==s)}catch(e){console.error("刪除待辦失敗",e)}},V=async s=>{const t=u("token"),e=a.value.find(l=>l.id===s);if(e)try{const l=await c.patch(`${d}todos/${s}/toggle`,{},{headers:{Authorization:t}});console.log(l),e.completed=!e.completed}catch(l){console.error("更新狀態失敗",l)}},z=A(()=>a.value.filter(s=>s.completed).length);return C(async()=>{const s=u("token");if(!s){f.push("/");return}try{const t=await c.get(`${d}users/checkout`,{headers:{Authorization:s}});i.value.nickname=t.data.nickname,i.value.uid=t.data.uid}catch(t){console.error("取得使用者資訊失敗",t)}try{const t=await c.get(`${d}todos`,{headers:{Authorization:s}});console.log(t),console.log(t.data),a.value=t.data.data,a.value=t.data.data.map(e=>({id:e.id,text:e.content,completed:e.status}))}catch(t){let e="";t.response&&t.response.status===400?e=t.response.data.message:e="請稍後再試！！",console.error("取得待辦事項失敗",e),w.fire({icon:"warning",title:"取得待辦事項失敗",text:e,confirmButtonColor:"#d33"})}}),(s,t)=>{const e=T("router-link"),l=T("router-view");return _(),h("div",q,[o("div",U,[r(j),o("div",F,[o("div",G,[I(o("input",{"onUpdate:modelValue":t[0]||(t[0]=g=>n.value=g),type:"text",placeholder:"請輸入待辦事項"},null,512),[[P,n.value]]),o("a",{href:"#",onClick:B(p,["prevent"])},t[1]||(t[1]=[o("i",{class:"fa fa-plus"},null,-1)]))]),a.value.length>0?(_(),h("div",H,[o("ul",J,[o("li",null,[r(e,{to:"/todolist-page/all",class:"tab-link","active-class":"active",exact:""},{default:v(()=>t[2]||(t[2]=[k(" 全部 ",-1)])),_:1,__:[2]})]),o("li",null,[r(e,{to:"/todolist-page/active",class:"tab-link","active-class":"active"},{default:v(()=>t[3]||(t[3]=[k(" 待完成 ",-1)])),_:1,__:[3]})]),o("li",null,[r(e,{to:"/todolist-page/completed",class:"tab-link","active-class":"active"},{default:v(()=>t[4]||(t[4]=[k(" 已完成 ",-1)])),_:1,__:[4]})])]),o("div",K,[o("ul",Q,[r(l,null,{default:v(({Component:g})=>[(_(),D(S(g),{todos:a.value,onRemove:N,onToggle:V},null,40,["todos"]))]),_:1})]),o("div",W,[o("p",null,L(z.value)+" 個已完成項目",1)])])])):(_(),h("div",X,t[5]||(t[5]=[o("p",null,"目前尚無待辦事項",-1),o("img",{src:M,alt:"todo_banner"},null,-1)])))])])])}}},ot=y(Y,[["__scopeId","data-v-4bec89b4"]]);export{ot as default};
