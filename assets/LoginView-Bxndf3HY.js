import{r as g,c as p,o as u,a as t,w as _,n as C,u as v,b as x,d as k,e as r,f,g as c,S as a,s as w,h as y,i as b}from"./index-D9LBVFIm.js";import{_ as B,T as h}from"./EmailInput-BR3qbon0.js";import{a as $}from"./index-NIGUFBhG.js";const P={class:"password formControls_area"},S={class:"password_input"},L=["type","value"],T={__name:"PasswordInput",props:{password:{type:String,default:""}},emits:["update:password"],setup(l,{emit:i}){const o=i,n=g(!1);return(m,s)=>(u(),p("div",P,[s[2]||(s[2]=t("label",{class:"formControls_label",for:"pwd"},"Password",-1)),t("div",S,[t("input",{class:"formControls_input",type:n.value?"text":"password",name:"pwd",id:"pwd",placeholder:"請輸入密碼",value:l.password,onInput:s[0]||(s[0]=e=>o("update:password",e.target.value))},null,40,L),t("a",{href:"#",class:"eye",onClick:s[1]||(s[1]=_(e=>n.value=!n.value,["prevent"]))},[t("i",{class:C(n.value?"fa-solid fa-eye":"fa-solid fa-eye-slash")},null,2)])])]))}},V={class:"other-link"},E="https://todolist-api.hexschool.io/",N={__name:"LoginForm",setup(l){const i=v(),o=x({email:"",password:""}),n=async()=>{if(console.log("email:",o.email),console.log("password:",o.password),!o.email||!o.password)return a.fire({icon:"warning",title:"請填寫全部欄位",text:"欄位尚未填寫完整",confirmButtonColor:"#d33"});if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o.email))return a.fire({icon:"warning",title:"Email 格式不正確",text:"請輸入正確的 Email 地址",confirmButtonColor:"#d33"});if(!/\d/.test(o.password)||!/[A-Za-z]/.test(o.password)||o.password.length<6||o.password.length>12)return a.fire({icon:"warning",title:"密碼格式不正確",text:"請確認密碼需為 6-12 碼，且包含英文與數字",confirmButtonColor:"#d33"});try{const s=await $.post(`${E}users/sign_in`,o,{headers:{"Content-Type":"application/json"}});console.log("登入成功",s),console.log(s.data.token),w("token",s.data.token,1),w("nickname",s.data.nickname,1),a.fire({icon:"success",title:"登入成功",text:s.data.nickname+" 歡迎回來！",confirmButtonColor:"#4f46e5",timer:2e3,timerProgressBar:!0}).then(()=>{i.push("/todolist-page")})}catch(s){console.error("登入失敗",s);let e;s.response&&(s.response.status===400||s.response.status===401||s.response.status===404)?e=s.response.data.message:e="請稍後再試！！",a.fire({icon:"warning",title:"登入失敗",text:e,confirmButtonColor:"#d33"}).then(()=>{o.email="",o.password=""})}};return(m,s)=>{const e=k("router-link");return u(),p("form",{class:"formControls",onSubmit:_(n,["prevent"])},[s[5]||(s[5]=t("h2",{class:"formControls_txt"},"最實用的線上代辦事項服務",-1)),r(B,{email:o.email,"onUpdate:email":s[0]||(s[0]=d=>o.email=d)},null,8,["email"]),r(T,{password:o.password,"onUpdate:password":s[1]||(s[1]=d=>o.password=d)},null,8,["password"]),t("div",V,[r(e,{class:"formControls_btnLink",to:"/register"},{default:f(()=>s[2]||(s[2]=[c("註冊",-1)])),_:1,__:[2]}),s[4]||(s[4]=t("span",{class:"line"},null,-1)),r(e,{class:"formControls_btnLink",to:"/retrieve"},{default:f(()=>s[3]||(s[3]=[c("忘記密碼",-1)])),_:1,__:[3]})]),s[6]||(s[6]=t("input",{class:"formControls_btnSubmit",type:"submit",value:"登入"},null,-1))],32)}}},z={class:"wrap bg-yellow"},A={id:"loginPage",class:"container loginPage"},U={__name:"LoginView",setup(l){const i=b();return y(()=>{i.query.message==="not-logged-in"&&a.fire({icon:"warning",title:"尚未登入",text:"請先登入帳號！",confirmButtonColor:"#d33"})}),(o,n)=>(u(),p("div",z,[t("div",A,[r(h),r(N)])]))}};export{U as default};
