import{_ as C,T as x}from"./EmailInput-BR3qbon0.js";import{u as P,r as f,b as w,d as B,c as d,o as m,a as c,e as n,F as y,f as k,g as $,w as D,S as o}from"./index-D9LBVFIm.js";import{a as S,_ as T}from"./BirthdayInput-tdQkO8D0.js";import{a as g}from"./index-NIGUFBhG.js";const v="https://todolist-api.hexschool.io/",F={__name:"RetrieveForm",setup(b){const p=P(),u=f(!1),e=w({email:"",birthday:""}),s=w({password:""}),l=f(""),_=async()=>{if(console.log("email:",e.email),console.log("birthday:",e.birthday),!e.email||!e.birthday)return o.fire({icon:"warning",title:"請填寫全部欄位",text:"欄位尚未填寫完整",confirmButtonColor:"#d33"});if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email))return o.fire({icon:"warning",title:"Email 格式不正確",text:"請輸入正確的 Email 地址",confirmButtonColor:"#d33"});if(!/^\d{4}\/\d{2}\/\d{2}$/.test(e.birthday))return o.fire({icon:"warning",title:"生日格式不正確",text:"請輸入正確格式 YYYY/MM/DD 或使用日期選擇器",confirmButtonColor:"#d33"});try{const a=await g.post(`${v}users/verify`,e,{headers:{"Content-Type":"application/json"}});console.log("驗證成功",a),o.fire({icon:"success",title:"驗證成功",text:"請設定密碼",timer:2e3,timerProgressBar:!0}),u.value=!0}catch(a){console.error("驗證失敗",a),o.fire({icon:"warning",title:"驗證失敗",text:a.response.status===400?a.response.data.message:"請稍後再試！！",confirmButtonColor:"#d33"}).then(()=>{e.email="",e.birthday=""})}},h=async()=>{if(console.log("password:",s.password),console.log("confirmPassword:",l.value),!/\d/.test(s.password)||!/[A-Za-z]/.test(s.password)||s.password.length<6||s.password.length>12)return o.fire({icon:"warning",title:"密碼格式不正確",text:"請確認密碼需為 6-12 碼，且包含英文與數字",confirmButtonColor:"#d33"});if(s.password!==l.value)return o.fire({icon:"warning",title:"密碼不一致",text:"請確認兩次輸入的密碼相同",confirmButtonColor:"#d33"});try{const r=await g.post(`${v}users/retrieve`,s,{headers:{"Content-Type":"application/json"}});console.log("密碼重設成功",r),o.fire({icon:"success",title:"密碼重設成功",text:"將傳送至登入頁",timer:2e3,timerProgressBar:!0}).then(()=>{p.push("/")})}catch(r){console.error("密碼重設失敗",r),o.fire({icon:"warning",title:"密碼重設失敗",text:r.response.status===400?r.response.data.message:"請稍後再試！！",confirmButtonColor:"#d33"}).then(()=>{s.password="",l.value=""})}};return(r,t)=>{const a=B("router-link");return m(),d("form",{class:"formControls",onSubmit:D(h,["prevent"])},[t[6]||(t[6]=c("h2",{class:"formControls_txt"},"重設密碼",-1)),u.value?(m(),d(y,{key:1},[n(T,{password:r.registerData.password,"onUpdate:password":t[2]||(t[2]=i=>r.registerData.password=i),confirmPassword:l.value,"onUpdate:confirmPassword":t[3]||(t[3]=i=>l.value=i)},null,8,["password","confirmPassword"]),t[4]||(t[4]=c("input",{class:"formControls_btnSubmit",type:"submit",value:"重設"},null,-1))],64)):(m(),d(y,{key:0},[n(C,{email:e.email,"onUpdate:email":t[0]||(t[0]=i=>e.email=i)},null,8,["email"]),n(S,{birthday:e.birthday,"onUpdate:birthday":t[1]||(t[1]=i=>e.birthday=i)},null,8,["birthday"]),c("input",{class:"formControls_btnSubmit",type:"button",value:"驗證",onClick:_})],64)),n(a,{class:"formControls_btnLink",to:"/"},{default:k(()=>t[5]||(t[5]=[$("登入",-1)])),_:1,__:[5]})],32)}}},U={class:"wrap bg-yellow"},V={id:"retrievePage",class:"container retrievePage"},R={__name:"RetrieveView",setup(b){return(p,u)=>(m(),d("div",U,[c("div",V,[n(x),n(F)])]))}};export{R as default};
